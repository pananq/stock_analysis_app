# SSL è¯ä¹¦å¿«é€Ÿå…¥é—¨æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨å¿«é€Ÿä¸ºè‚¡ç¥¨åˆ†æç³»ç»Ÿé…ç½® SSL è¯ä¹¦ï¼Œå®ç° HTTPS å®‰å…¨è®¿é—®ã€‚

---

## ğŸš€ å¿«é€Ÿé€‰æ‹©æ–¹æ¡ˆ

### ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰

**æ–¹æ¡ˆï¼šLet's Encrypt + Nginx**

- âœ… å…è´¹è¯ä¹¦
- âœ… è‡ªåŠ¨ç»­æœŸ
- âœ… é«˜æ€§èƒ½
- âœ… æµè§ˆå™¨ä¿¡ä»»

### å¼€å‘æµ‹è¯•

**æ–¹æ¡ˆï¼šè‡ªç­¾åè¯ä¹¦ + Flask**

- âœ… é…ç½®ç®€å•
- âœ… å¿«é€Ÿéƒ¨ç½²
- âš ï¸ æµè§ˆå™¨è­¦å‘Š
- âš ï¸ ä»…å†…ç½‘è®¿é—®

---

## ğŸ“‹ ç”Ÿäº§ç¯å¢ƒé…ç½®æ­¥éª¤

### å‰ç½®æ¡ä»¶

- âœ… å·²æœ‰åŸŸåï¼ˆå¦‚ï¼šstock-analysis.yourdomain.comï¼‰
- âœ… åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨ IP
- âœ… æœåŠ¡å™¨å¼€æ”¾ 80 å’Œ 443 ç«¯å£
- âœ… æœåŠ¡å™¨å…·æœ‰ root æƒé™

### ä¸€é”®é…ç½®ï¼ˆæ¨èï¼‰

ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬å®Œæˆé…ç½®ï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /data/home/aaronpan/stock-analysis-app

# è¿è¡Œé…ç½®è„šæœ¬
sudo ./setup_ssl.sh
```

æŒ‰æç¤ºé€‰æ‹©ï¼š
1. é€‰æ‹© `1` (Let's Encrypt + Nginx)
2. è¾“å…¥åŸŸåï¼ˆå¦‚ï¼šstock-analysis.yourdomain.comï¼‰
3. è¾“å…¥é‚®ç®±ï¼ˆç”¨äºè¯ä¹¦æé†’ï¼‰
4. ç¡®è®¤é…ç½®ä¿¡æ¯
5. ç­‰å¾…è‡ªåŠ¨é…ç½®å®Œæˆ

### æ‰‹åŠ¨é…ç½®æ­¥éª¤

å¦‚æœéœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œè¯·å‚è€ƒè¯¦ç»†æ–‡æ¡£ï¼š[SSL_CERTIFICATE_SETUP.md](SSL_CERTIFICATE_SETUP.md)

---

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®æ­¥éª¤

### å¿«é€Ÿç”Ÿæˆè‡ªç­¾åè¯ä¹¦

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /data/home/aaronpan/stock-analysis-app

# è¿è¡Œé…ç½®è„šæœ¬
sudo ./setup_ssl.sh
```

æŒ‰æç¤ºé€‰æ‹©ï¼š
1. é€‰æ‹© `2` (è‡ªç­¾åè¯ä¹¦ + Flask)
2. ç¡®è®¤é¡¹ç›®ç›®å½•
3. ç­‰å¾…è¯ä¹¦ç”Ÿæˆ

### ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config.yaml`ï¼š

```yaml
api:
  ssl_enabled: true
  ssl_cert: "/data/home/aaronpan/stock-analysis-app/ssl/server.crt"
  ssl_key: "/data/home/aaronpan/stock-analysis-app/ssl/server.key"

web:
  ssl_enabled: true
  ssl_cert: "/data/home/aaronpan/stock-analysis-app/ssl/server.crt"
  ssl_key: "/data/home/aaronpan/stock-analysis-app/ssl/server.key"
```

### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡
python main.py start

# è®¿é—®
# Webç•Œé¢: https://localhost:8000
# APIæ¥å£: https://localhost:5000/api
```

**æ³¨æ„**ï¼šæµè§ˆå™¨ä¼šæ˜¾ç¤ºå®‰å…¨è­¦å‘Šï¼Œç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­è®¿é—®"å³å¯ã€‚

---

## âœ… éªŒè¯é…ç½®

### æ£€æŸ¥ SSL çŠ¶æ€

```bash
# ä½¿ç”¨è„šæœ¬æ£€æŸ¥
sudo ./setup_ssl.sh
# é€‰æ‹© 4 (æ£€æŸ¥SSLçŠ¶æ€)

# æˆ–æ‰‹åŠ¨æ£€æŸ¥
curl -I https://yourdomain.com
```

### åœ¨çº¿æµ‹è¯•

è®¿é—® SSL Labs æµ‹è¯•ç½‘ç«™ï¼š

https://www.ssllabs.com/ssltest/

è¾“å…¥æ‚¨çš„åŸŸåï¼ŒæŸ¥çœ‹ SSL å®‰å…¨è¯„åˆ†ã€‚

---

## ğŸ”„ è¯ä¹¦ç»­æœŸ

### Let's Encrypt è¯ä¹¦

Let's Encrypt è¯ä¹¦è‡ªåŠ¨ç»­æœŸï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

**æŸ¥çœ‹ç»­æœŸçŠ¶æ€**ï¼š
```bash
# æŸ¥çœ‹è¯ä¹¦åˆ°æœŸæ—¶é—´
sudo certbot certificates

# æŸ¥çœ‹è‡ªåŠ¨ç»­æœŸä»»åŠ¡
sudo systemctl status certbot.timer

# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run
```

### è‡ªç­¾åè¯ä¹¦

è‡ªç­¾åè¯ä¹¦é»˜è®¤æœ‰æ•ˆæœŸ 365 å¤©ï¼Œåˆ°æœŸåéœ€é‡æ–°ç”Ÿæˆï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /data/home/aaronpan/stock-analysis-app

# é‡æ–°ç”Ÿæˆè¯ä¹¦
cd ssl
rm -f server.crt server.key
openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=YourCompany/OU=IT/CN=localhost"
openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt

# é‡å¯æœåŠ¡
python main.py restart
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### 1. è¯ä¹¦è·å–å¤±è´¥

**é”™è¯¯**ï¼š`Failed to connect to host for DVSNI challenge`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥åŸŸåè§£ææ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 80 å’Œ 443 ç«¯å£
- ç¡®è®¤ Nginx é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®

### 2. æµè§ˆå™¨æ˜¾ç¤ºä¸å®‰å…¨

**åŸå› **ï¼šè‡ªç­¾åè¯ä¹¦ä¸è¢«æµè§ˆå™¨ä¿¡ä»»

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¼€å‘ç¯å¢ƒï¼šç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­è®¿é—®"
- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ Let's Encrypt æˆ–å•†ä¸šè¯ä¹¦

### 3. Nginx å¯åŠ¨å¤±è´¥

**é”™è¯¯**ï¼š`nginx: [emerg] invalid number of arguments`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### 4. æ··åˆå†…å®¹è­¦å‘Š

**é”™è¯¯**ï¼šHTTPS é¡µé¢åŒ…å« HTTP èµ„æº

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ‰€æœ‰èµ„æºé“¾æ¥æ˜¯å¦ä½¿ç”¨ HTTPS
- ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š`//cdn.example.com/js/app.js`

### 5. æ€§èƒ½é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¯ç”¨ HTTP/2
- é…ç½® SSL ä¼šè¯ç¼“å­˜
- ä½¿ç”¨ CDN

---

## ğŸ“Š é…ç½®å¯¹æ¯”

| ç‰¹æ€§ | Let's Encrypt | è‡ªç­¾åè¯ä¹¦ | å•†ä¸šè¯ä¹¦ |
|------|--------------|-----------|---------|
| **è´¹ç”¨** | å…è´¹ | å…è´¹ | ä»˜è´¹ |
| **æµè§ˆå™¨ä¿¡ä»»** | âœ“ | âœ— | âœ“ |
| **è‡ªåŠ¨ç»­æœŸ** | âœ“ | âœ— | âœ— |
| **é…ç½®éš¾åº¦** | ä¸­ç­‰ | ç®€å• | ä¸­ç­‰ |
| **é€‚ç”¨åœºæ™¯** | ç”Ÿäº§ç¯å¢ƒ | å¼€å‘æµ‹è¯• | ä¼ä¸šåº”ç”¨ |
| **åŸŸåè¦æ±‚** | éœ€è¦ | ä¸éœ€è¦ | éœ€è¦ |
| **è¯ä¹¦æœ‰æ•ˆæœŸ** | 90å¤© | è‡ªå®šä¹‰ | 1-2å¹´ |

---

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

1. **ä½¿ç”¨å¼ºåŠ å¯†**
   - ä»…å¯ç”¨ TLS 1.2 å’Œ TLS 1.3
   - ä½¿ç”¨æ¨èçš„åŠ å¯†å¥—ä»¶

2. **å¯ç”¨ HSTS**
   - å¼ºåˆ¶æµè§ˆå™¨ä½¿ç”¨ HTTPS
   - é˜²æ­¢é™çº§æ”»å‡»

3. **ä¿æŠ¤ç§é’¥**
   - ä¸¥æ ¼é™åˆ¶ç§é’¥æ–‡ä»¶æƒé™
   - å®šæœŸè½®æ¢å¯†é’¥

4. **ç›‘æ§è¯ä¹¦çŠ¶æ€**
   - å®šæœŸæ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
   - è®¾ç½®åˆ°æœŸæé†’

5. **å®šæœŸæ›´æ–°**
   - ä¿æŒç³»ç»Ÿè½¯ä»¶æœ€æ–°
   - åŠæ—¶æ›´æ–°è¯ä¹¦

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¯¦ç»†é…ç½®æ–‡æ¡£](SSL_CERTIFICATE_SETUP.md)
- [é…ç½®ç¤ºä¾‹æ–‡ä»¶](config.example.yaml)
- [è‡ªåŠ¨åŒ–é…ç½®è„šæœ¬](setup_ssl.sh)

---

## ğŸ’¡ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# è¿è¡Œé…ç½®å‘å¯¼
sudo ./setup_ssl.sh

# æ£€æŸ¥è¯ä¹¦çŠ¶æ€
sudo certbot certificates

# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run

# æŸ¥çœ‹ Nginx é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl reload nginx

# é‡å¯åº”ç”¨
python main.py restart

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š[SSL_CERTIFICATE_SETUP.md](SSL_CERTIFICATE_SETUP.md)
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ï¼š
   - `/var/log/nginx/error.log`
   - `logs/app.log`
3. è¿è¡Œè¯Šæ–­ï¼š
   ```bash
   sudo ./setup_ssl.sh
   # é€‰æ‹© 4 (æ£€æŸ¥SSLçŠ¶æ€)
   ```

---

**ç¥æ‚¨é…ç½®é¡ºåˆ©ï¼** ğŸ‰
