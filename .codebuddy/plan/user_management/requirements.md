# 需求文档

## 引言
本项目旨在为股票分析系统引入用户管理模块，实现多用户环境下的资源隔离与权限控制。系统将区分管理员与普通用户，确保数据安全及个性化体验。普通用户拥有独立的策略和任务空间，而基础股票数据由管理员统一维护。

## 需求

### 需求 1：用户认证体系

**用户故事：** 作为一名普通用户，我希望能够注册账户并登录系统，以便访问我的个人数据和功能。

#### 验收标准
1. IF 用户提交注册请求 THEN 系统 SHALL 校验用户名是否符合“8-32个英文字母或数字字符，且第一个符号不能是数字”的格式。
2. IF 用户名已存在 OR 格式不符 THEN 系统 SHALL 拒绝注册并提示错误。
3. IF 用户输入正确的用户名和密码 THEN 系统 SHALL 允许登录并跳转至仪表板。
4. IF 用户未登录尝试访问受保护页面 THEN 系统 SHALL 重定向至登录页面。
5. WHEN 用户点击注销 THEN 系统 SHALL 清除登录状态并返回登录页。

### 需求 2：管理员账号管理

**用户故事：** 作为一名系统维护者，我希望系统预置管理员账号，并能通过工具重置凭证，以便在初始化或忘记密码时管理系统。

#### 验收标准
1. IF 系统首次启动且无管理员账号 THEN 系统 SHALL 自动创建默认管理员账号。
2. WHEN 管理员使用提供的命令行工具（CLI）更新密码 THEN 系统 SHALL 更新数据库中的管理员凭证。
3. IF 管理员尝试使用旧密码登录 THEN 系统 SHALL 拒绝访问。

### 需求 3：页面访问权限控制

**用户故事：** 作为一名管理员，我希望控制不同角色的页面访问权限，以便保护敏感操作和数据。

#### 验收标准
1. IF 当前用户是普通用户 THEN 系统 SHALL 仅允许访问“仪表板”、“策略管理”、“股票查询”页面。
2. IF 当前用户是普通用户尝试访问“系统管理”或“数据更新”等页面 THEN 系统 SHALL 显示“无权访问”或重定向。
3. IF 当前用户是管理员 THEN 系统 SHALL 允许访问所有页面。

### 需求 4：策略与任务的数据隔离

**用户故事：** 作为一名用户，我希望我的策略和任务执行记录是私有的，以便独立管理我的交易逻辑而不受他人干扰。

#### 验收标准
1. WHEN 用户查看策略列表 THEN 系统 SHALL 仅显示该用户创建的策略。
2. WHEN 用户创建新策略 THEN 系统 SHALL 将该策略与当前用户ID关联。
3. IF 用户尝试编辑、删除或执行非自己创建的策略 THEN 系统 SHALL 拒绝操作。
4. WHEN 用户查看任务列表（对应数据库 `job_logs` 表）或执行结果 THEN 系统 SHALL 仅显示属于该用户的记录。

### 需求 5：公共数据管理

**用户故事：** 作为一名管理员，我希望统一维护股票基础数据，以便所有用户都能看到一致且准确的市场信息。

#### 验收标准
1. WHEN 任何用户（管理员或普通用户）查询股票信息或行情数据 THEN 系统 SHALL 显示相同的公共数据。
2. IF 普通用户尝试触发股票数据更新或同步 THEN 系统 SHALL 拒绝操作并提示权限不足。
3. IF 管理员触发股票数据更新 THEN 系统 SHALL 执行更新操作，且更新后的数据对所有用户可见。

## 附录：数据模型映射说明

为了消除歧义，以下是业务概念与数据库表的对应关系：
- **任务/任务列表**：对应数据库中的 `job_logs` 表。该表记录了策略执行的任务实例。
- **任务详情**：对应数据库中的 `task_execution_details` 表，通过 `job_log_id` 关联。
